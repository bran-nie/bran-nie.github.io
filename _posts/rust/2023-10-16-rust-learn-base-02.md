---
layout: post
title: Rust åŸºç¡€å…¥é—¨ - 02ï¼ˆæ‰€æœ‰æƒå’Œå€Ÿç”¨ï¼‰
categories: [Rust]
description: Rust åŸºç¡€å…¥é—¨ - 02
keywords: Rust åŸºç¡€å…¥é—¨ - 02
---

è¿™æ˜¯ bran å­¦ä¹  Rust çš„ç¬”è®° & å¿ƒå¾—ç³»åˆ—ï¼Œç›®å‰æ˜¯ Rust åŸºç¡€å…¥é—¨ - 02ï¼ˆæ‰€æœ‰æƒå’Œå€Ÿç”¨ï¼‰ï¼Œåˆšå¼€å§‹å­¦å“¦ï½ž åŠ æ²¹ï¼ï¼ï¼

## æ‰€æœ‰æƒ

å› ä¸ºç¨‹åºè¦è¿è¡Œï¼Œå°±è¦å’Œè®¡ç®—æœºå†…å­˜æ‰“äº¤é“ï¼Œé‚£ä¹ˆå¦‚ä½•åœ¨å†…å­˜ä¸­ç”³è¯·ç©ºé—´ã€é‡Šæ”¾ç©ºé—´ï¼Œæˆäº†è¯­è¨€è®¾è®¡çš„é‡ä¸­ä¹‹é‡ã€‚

åº”ç”¨ç¨‹åºå’Œè®¡ç®—æœºå†…å­˜çš„çˆ±æ¨æƒ…ä»‡ï¼Œç›®å‰æœ‰ä¸‰ç§æµæ´¾ã€‚

1. **åžƒåœ¾å›žæ”¶æœºåˆ¶ï¼ˆGarbage Collectionï¼‰**ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œä¸æ–­å¯»æ‰¾ä¸å†ä½¿ç”¨çš„å†…å­˜ï¼Œè¿›è¡Œå›žæ”¶å¤„ç†ã€‚å…¸åž‹ä»£è¡¨ï¼šJavaã€Goã€JavaScript
2. **æ‰‹åŠ¨ç®¡ç†å†…å­˜çš„åˆ†é…å’Œé‡Šæ”¾**ï¼Œåœ¨ç¨‹åºä¸­ï¼Œé€šè¿‡å‡½æ•°è°ƒç”¨çš„æ–¹å¼æ¥ç”³è¯·å’Œé‡Šæ”¾å†…å­˜ã€‚å…¸åž‹ä»£è¡¨ï¼šCã€C++ã€æ—©æœŸçš„ OC
3. **é€šè¿‡æ‰€æœ‰æƒæ¥ç®¡ç†å†…å­˜**ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šæ ¹æ®ä¸€ç³»åˆ—çš„è§„åˆ™è¿›è¡Œæ£€æŸ¥

Rust é€‰æ‹©äº†ç¬¬ä¸‰ç§ï¼Œè¿™ç§æ£€æŸ¥åªå‘ç”Ÿåœ¨ç¼–è¯‘æœŸï¼Œå› æ­¤å¯¹äºŽç¨‹åºè¿è¡ŒæœŸï¼Œä¸ä¼šæœ‰ä»»ä½•æ€§èƒ½ä¸Šçš„æŸå¤±ã€‚ï¼ˆè¿˜ä¸å¤ªæ‡‚è¿™ä¸ªä¸ºä»€ä¹ˆæ²¡æœ‰ï¼Œå¸¦ç€ç–‘æƒ‘ç»§ç»­å­¦ä¹ ï¼‰

## æ ˆ(Stack)å’Œå †(Heap)

åœ¨ Rust ä¸­ï¼Œæ ˆå’Œå †æ˜¯æœ€æ ¸å¿ƒçš„æ•°æ®ç»“æž„ï¼Œæ•°æ®æ˜¯ä½äºŽæ ˆä¸Šï¼Œè¿˜æ˜¯å †ä¸Šï¼Œéžå¸¸é‡è¦ï¼Œå› ä¸ºè¿™ä¼šå½±å“ç¨‹åºçš„è¡Œä¸ºå’Œæ€§èƒ½

> Meï¼šå¯¹äºŽ jser æ¥è¯´ï¼Œè¿™ä¸ªæ¦‚å¿µåº”è¯¥å¥½ç†è§£çš„

### æ ˆ

- æŒ‰ç…§é¡ºåºå­˜å‚¨å€¼å¹¶ä»¥ç›¸åçš„é¡ºåºå–å‡ºå€¼ï¼Œï¼ˆå…ˆè¿›åŽå‡ºï¼‰ï¼ˆåŽè¿›å…ˆå‡ºï¼‰ã€‚
- å¢žåŠ æ•°æ®å«**_è¿›æ ˆ_**ï¼Œç§»å‡ºæ•°æ®å«**_å‡ºæ ˆ_**
- æ ˆä¸­çš„æ‰€æœ‰æ•°æ®éƒ½å¿…é¡»å æœ‰**å·²çŸ¥ä¸”å›ºå®šå¤§å°çš„å†…å­˜ç©ºé—´**ï¼Œå‡è®¾æ•°æ®å¤§å°æ˜¯æœªçŸ¥çš„ï¼Œé‚£ä¹ˆå–å‡ºæ•°æ®æ—¶ï¼Œå°†æ— æ³•å–åˆ°æƒ³è¦çš„æ•°æ®ã€‚ã€‚

### å †

- ä¸Žæ ˆä¸åŒï¼Œå¤§å°æœªçŸ¥æˆ–è€…å¯èƒ½å˜åŒ–çš„æ•°æ®ï¼Œå¯ä»¥å­˜æ”¾åœ¨å †ä¸Š
- å †çš„å†…å­˜ç©ºé—´ä¸è¿žç»­
- å‘å †ä¸Šå­˜æ”¾æ•°æ®æ—¶ï¼Œå…ˆç”³è¯·ä¸€å®šå¤§å°çš„ç©ºé—´ï¼Œæ“ä½œç³»ç»Ÿåœ¨å †çš„æŸå¤„æ‰¾åˆ°è¶³å¤Ÿå¤§çš„ç©ºé—´åŽï¼Œå°†å…¶æ ‡è®°ä¸ºå·²ä½¿ç”¨ï¼Œå¹¶è¿”å›žä¸€ä¸ªè¡¨ç¤ºè¯¥åœ°å€çš„**æŒ‡é’ˆ**ã€‚è¯¥è¿‡ç¨‹è¢«ç§°ä¸º**åœ¨å †ä¸Šåˆ†é…å†…å­˜**ï¼Œæœ‰æ—¶ç®€ç§°â€œåˆ†é…â€ï¼ˆallocatingï¼‰
- è¯¥æŒ‡é’ˆä¼šè¢«æŽ¨å…¥æ ˆä¸­ï¼ŒåŽç»­é€šè¿‡è¯¥æŒ‡é’ˆæ¥è®¿é—®å®žé™…çš„å†…å­˜ä½ç½®ï¼Œè¿›è€Œè®¿é—®æ•°æ®

### æ€§èƒ½åŒºåˆ«

- å†™å…¥æ–¹é¢ï¼šå…¥æ ˆæ¯”åœ¨å †ä¸Šåˆ†é…å†…å­˜æ›´å¿«
- è¯»å–æ–¹é¢ï¼šç”±äºŽå †çš„å†…å­˜åœ°å€ä¹Ÿæ˜¯åœ¨æ ˆä¸­ï¼Œå†åŠ ä¸ŠçŽ°ä»£çš„ CPU æ€§èƒ½åŠé«˜é€Ÿç¼“å­˜ï¼Œæ ˆçš„è®¿é—®é€Ÿåº¦ä¹Ÿæ˜¯ä¼˜äºŽå †çš„

å› æ­¤ï¼Œå¤„ç†å™¨å¤„ç†åˆ†é…åœ¨æ ˆä¸Šæ•°æ®ä¼šæ¯”åœ¨å †ä¸Šçš„æ•°æ®æ›´åŠ é«˜æ•ˆã€‚

### æ‰€æœ‰æƒä¸Žå †æ ˆ

å¯¹äºŽå…¶ä»–å¾ˆå¤šç¼–ç¨‹è¯­è¨€ï¼Œä½ ç¡®å®žæ— éœ€ç†è§£å †æ ˆçš„åŽŸç†ï¼Œä½†æ˜¯**åœ¨ Rust ä¸­ï¼Œæ˜Žç™½å †æ ˆçš„åŽŸç†ï¼Œå¯¹äºŽæˆ‘ä»¬ç†è§£æ‰€æœ‰æƒçš„å·¥ä½œåŽŸç†ä¼šæœ‰å¾ˆå¤§çš„å¸®åŠ©**ã€‚

## æ‰€æœ‰æƒåŽŸåˆ™

> - Rust ä¸­æ¯ä¸€ä¸ªå€¼éƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰ï¼Œè¯¥å˜é‡è¢«ç§°ä¸ºå€¼çš„æ‰€æœ‰è€…
> - ä¸€ä¸ªå€¼åŒæ—¶åªèƒ½è¢«ä¸€ä¸ªå˜é‡æ‰€æ‹¥æœ‰
> - å½“æ‰€æœ‰è€…ï¼ˆå˜é‡ï¼‰ç¦»å¼€ä½œç”¨åŸŸèŒƒå›´å†…æ—¶ï¼Œè¿™ä¸ªå€¼å°†è¢«ä¸¢å¼ƒï¼ˆdropï¼‰

### å˜é‡ä½œç”¨åŸŸ

- ç±»ä¼¼ jsï¼Œå‡½æ•°ï¼Œå—çº§ä½œç”¨åŸŸ

- Rust ä¸­ï¼Œå­—ç¬¦æ˜¯åŸºæœ¬ç±»åž‹ï¼Œæ˜¯å’Œ String ä¸ä¸€æ ·çš„ï¼Œjs ä¸­å€’æ˜¯æ²¡æœ‰è¿™ç§åŒºåˆ«ã€‚å­—ç¬¦`''`ï¼Œå­—ç¬¦ä¸²`""`

### ç®€å•ä»‹ç» String ç±»åž‹

- å­—ç¬¦ä¸²æœ‰**å­—ç¬¦ä¸²å­—é¢é‡**ï¼Œä¹Ÿæœ‰**åŠ¨æ€å­—ç¬¦ä¸²ç±»åž‹**ã€‚è¿™å’Œ js å¾ˆä¸ä¸€æ ·ï¼Œjs å¾ˆçµæ´»ã€‚

- å› ä¸º String æ˜¯å­˜å‚¨åœ¨å †ä¸Šï¼Œæ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥å¯ä»¥ä¿®æ”¹

  ```rust
  let c = 'c'; // å­—ç¬¦
  let s1 = "hello"; // å­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²å­—é¢é‡ï¼Œä¸€ç»ç¡®å®šä¸å¯å†å˜ï¼Œå·²ç»è¢«ç¡¬ç¼–ç åˆ°ç¨‹åºä»£ç ä¸­äº†ã€‚
  let s2 = String::from("hello"); // å­—ç¬¦ä¸²ï¼ŒåŠ¨æ€å­—ç¬¦ä¸²ç±»åž‹
  s2.push_str(", world!"); // å› ä¸ºæ˜¯åŠ¨æ€çš„ï¼Œæ‰€ä»¥å¯ä»¥å†ä¿®æ”¹
  ```

- ä¸Šé¢ä»£ç ä¸­çš„ `String::from`ä¸­çš„ï¼šæ˜¯è°ƒç”¨æ“ä½œç¬¦ï¼Œç±»ä¼¼ js ä¸­çš„ `String.from` çš„ .ï¼ˆPSï¼šæˆ‘è§‰å¾— . å¤šå¥½ç”¨å•Šï¼Œhhhï¼‰

## å˜é‡ç»‘å®šèƒŒåŽçš„æ•°æ®äº¤äº’

### è½¬ç§»æ‰€æœ‰æƒ

```rus
let x = 5;
let y = x;
```

å£°æ˜Ž xï¼Œèµ‹å€¼ 5ï¼Œå£°æ˜Ž yï¼Œå°† x èµ‹å€¼ç»™ yï¼Œx,y éƒ½ç­‰äºŽ 5ï¼Œå› ä¸ºæ•´æ•°æ˜¯ Rust åŸºæœ¬æ•°æ®ç±»åž‹ï¼Œæ˜¯å›ºå®šå¤§å°çš„ç®€å•å€¼ï¼Œå› æ­¤è¿™ä¸¤ä¸ªå€¼éƒ½æ˜¯é€šè¿‡**è‡ªåŠ¨æ‹·è´**çš„æ–¹å¼æ¥èµ‹å€¼çš„ï¼Œéƒ½è¢«å­˜åœ¨æ ˆä¸­ï¼Œå®Œå…¨æ— éœ€åœ¨å †ä¸Šåˆ†é…å†…å­˜ã€‚

```rust
let s1 = String::from("hello");
let s2 = s1;
```

å½“å˜é‡ç±»åž‹æ˜¯ String æ—¶ï¼Œå°±ä¸æ˜¯**è‡ªåŠ¨æ‹·è´**äº†ï¼Œå› ä¸º String ä¸æ˜¯åŸºæœ¬ç±»åž‹ï¼Œè€Œä¸”æ˜¯å­˜å‚¨åœ¨å †ä¸Šçš„æ•°æ®ï¼Œ

å®žé™…ä¸Šï¼ŒString æ˜¯ä¸€ä¸ªå¤æ‚ç±»åž‹ï¼Œç”±**å­˜å‚¨åœ¨æ ˆä¸­çš„æŒ‡é’ˆã€å­—ç¬¦ä¸²é•¿åº¦ã€å­—ç¬¦ä¸²å®¹é‡**å…±åŒç»„æˆï¼Œå…¶ä¸­å †æŒ‡é’ˆå¼æœ€é‡è¦çš„ï¼ˆå› ä¸ºå®ƒæŒ‡å‘æ•°æ®åœ¨å†…å­˜ä¸­çœŸæ­£å­˜æ”¾çš„åœ°å€ï¼Œå¯ä»¥ç†è§£ä¸ºé—¨ç‰Œå· hhhï¼‰è‡³äºŽé•¿åº¦ã€å®¹é‡ï¼Œä¹Ÿå°±æ˜¯é™„åŠ ä¿¡æ¯ï¼Œå®¹é‡æ˜¯åˆ†é…å¤§å°ï¼Œé•¿åº¦æ˜¯å·²ä½¿ç”¨å¤§å°ï¼Œï¼ˆå¤šå¤§çš„æˆ¿å­å’Œå·²ç»ä½äº†å¤šå°‘äººï¼Œhhhï¼‰

å› æ­¤ï¼Œå¯¹ String ç±»åž‹çš„ copyï¼Œåˆ†ä¸¤ç§æƒ…å†µï¼š

1. æ‰€æœ‰éƒ½æ‹·è´ï¼Œä¹Ÿå°±æ˜¯æ·±æ‹·è´
2. åªæ‹·è´æŒ‡é’ˆã€å®¹é‡ã€å¤§å°è¿™äº› id å¡
   1. ä½†æ˜¯è¿™æ ·å°±è¿èƒŒäº†ä¸€ä¸ªå€¼åªèƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼
   2. å‡å®šåªæ‹·è´æŒ‡é’ˆç­‰ï¼Œé‚£ä¹ˆä¸Šé¢ä»£ç ä¸­ s1 å’Œ s2 åŒæ—¶éƒ½æ˜¯å€¼çš„æ‰€æœ‰è€…ï¼Œå½“ s1ã€s2 ç¦»å¼€ä½œç”¨åŸŸæ—¶ï¼ŒRust éƒ½ä¼šå°è¯•é‡Šæ”¾ç›¸åŒçš„å†…å­˜ï¼Œä½†ç¬¬äºŒæ¬¡é‡Šæ”¾æ—¶ï¼Œä¸å°±å‡ºçŽ°é”™è¯¯äº†å—ï¼Œ

å› æ­¤ï¼ŒRust ä¸­ï¼Œs1 èµ‹å€¼ç»™ s2 æ—¶ï¼Œs1 ä¸å†æœ‰æ•ˆï¼Œå› æ­¤ä¹Ÿæ— éœ€ drop s1ï¼Œå€¼å½“æ‰€æœ‰æƒå°±åˆ° s2 äº†ï¼Œs1 åœ¨èµ‹å€¼ä¹‹åŽï¼Œå°±å¤±æ•ˆäº†ã€‚

![](https://raw.githubusercontent.com/bran-nie/blog_images/images/blog/20231026150530.png)

- åœ¨ js ä¸­ï¼Œå¯¹ Object çš„æ‹·è´ï¼Œæœ‰æ·±æ‹·è´ï¼ˆdeep copyï¼‰å’Œæµ…æ‹·è´ï¼ˆshallow copyï¼‰ï¼Œåªæ‹·è´æŒ‡é’ˆã€ï¼ˆé•¿åº¦ã€å®¹é‡ï¼‰è€Œä¸æ‹·è´æ•°æ®ï¼Œå¬èµ·æ¥åƒæ˜¯æµ…æ‹·è´ï¼Œä½†åˆå› ä¸º Rust åŒæ—¶ä½¿ç¬¬ä¸€ä¸ªå˜é‡ s1 æ— æ•ˆäº†ï¼Œå› æ­¤è¿™ä¸ªæ“ä½œï¼Œè¢«ç§°ä¸º**ç§»åŠ¨ï¼ˆmoveï¼‰**ï¼Œè€Œä¸æ˜¯æµ…æ‹·è´ã€‚

![s1 moved to s2](https://raw.githubusercontent.com/bran-nie/blog_images/images/blog/rust-move.jpg)

```rust
fn main() {
    let x: &str = "hello, world";
    let y = x;
    println!("{},{}",x,y);
}
```

- ä½†ä¸Šé¢è¿™æ®µä»£ç ï¼Œå°±ä¸ä¼šæŠ¥é”™ï¼Œæ–‡ç« è¯´ï¼š

- > è¿™æ®µä»£ç å’Œä¹‹å‰çš„ `String` æœ‰ä¸€ä¸ªæœ¬è´¨ä¸Šçš„åŒºåˆ«ï¼šåœ¨ `String` çš„ä¾‹å­ä¸­ `s1` æŒæœ‰äº†é€šè¿‡`String::from("hello")` åˆ›å»ºçš„å€¼çš„æ‰€æœ‰æƒï¼Œè€Œè¿™ä¸ªä¾‹å­ä¸­ï¼Œ`x` åªæ˜¯å¼•ç”¨äº†å­˜å‚¨åœ¨äºŒè¿›åˆ¶ä¸­çš„å­—ç¬¦ä¸² `"hello, world"`ï¼Œå¹¶æ²¡æœ‰æŒæœ‰æ‰€æœ‰æƒã€‚
  >
  > å› æ­¤ `let y = x` ä¸­ï¼Œä»…ä»…æ˜¯å¯¹è¯¥å¼•ç”¨è¿›è¡Œäº†æ‹·è´ï¼Œæ­¤æ—¶ `y` å’Œ `x` éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

- æˆ‘è¿˜ä¸æ˜¯å¾ˆç†è§£ï¼ŒæŒ‰ç…§ä¸Šé¢æåˆ°çš„æ‰€æœ‰æƒåŽŸåˆ™ï¼Œæ¯ä¸ªå€¼éƒ½æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œä¸€ä¸ªå€¼åªèƒ½åŒæ—¶æœ‰ä¸€ä¸ªæ‰€æœ‰è€…ï¼Œé‚£ä¹ˆï¼Œè¿™å¥è¯**æ­¤æ—¶ `y` å’Œ `x` éƒ½å¼•ç”¨äº†åŒä¸€ä¸ªå­—ç¬¦ä¸²**åˆæ˜¯ä»€ä¹ˆæƒ…å†µå‘¢ï¼Œç»§ç»­çœ‹ã€‚

  - ç¬”è®° - `&T` è¡¨ç¤ºæ˜¯ ä¸å¯å˜å¼•ç”¨ï¼ŒT ä¸ºç±»åž‹
  - ç¬”è®°- `&mut` è¡¨ç¤ºæ˜¯ å¯å˜å¼•ç”¨

### å…‹éš†ï¼ˆæ·±æ‹·è´ï¼‰

- å¦‚æžœä»£ç æ€§èƒ½æ— å…³ç´§è¦ï¼Œä¾‹å¦‚åˆå§‹åŒ–ç¨‹åºæ—¶ï¼Œæˆ–è€…åœ¨æŸæ®µæ—¶é—´åªä¼šæ‰§è¡Œä¸€æ¬¡æ—¶ï¼Œä½ å¯ä»¥ä½¿ç”¨ `clone` æ¥ç®€åŒ–ç¼–ç¨‹ã€‚ä½†æ˜¯å¯¹äºŽæ‰§è¡Œè¾ƒä¸ºé¢‘ç¹çš„ä»£ç (çƒ­ç‚¹è·¯å¾„)ï¼Œä½¿ç”¨ `clone` ä¼šæžå¤§çš„é™ä½Žç¨‹åºæ€§èƒ½ï¼Œéœ€è¦å°å¿ƒä½¿ç”¨

### æ‹·è´ï¼ˆæµ…æ‹·è´ï¼‰

- æµ…æ‹·è´åªå‘ç”Ÿåœ¨æ ˆä¸Šï¼Œå› æ­¤æ€§èƒ½å¾ˆé«˜ï¼Œåœ¨æ—¥å¸¸ç¼–ç¨‹ä¸­ï¼Œæµ…æ‹·è´æ— å¤„ä¸åœ¨
- Rust æœ‰ä¸€ä¸ªå«åš Copy çš„ç‰¹å¾
  - å¦‚æžœä¸€ä¸ªç±»åž‹æ‹¥æœ‰ Copy ç‰¹å¾ï¼Œä¸€ä¸ªæ—§çš„å˜é‡åœ¨è¢«èµ‹å€¼ç»™å…¶ä»–å˜é‡åŽï¼Œä»ç„¶å¯ç”¨
  - ä»»ä½•åŸºæœ¬ç±»åž‹çš„ç»„åˆå¯ä»¥ copyï¼Œä¸éœ€è¦åˆ†é…å†…å­˜æˆ–è€…æŸç§å½¢å¼èµ„æºçš„ç±»åž‹å¯ä»¥ copyã€‚ï¼ˆå…·ä½“å¯ä»¥æŸ¥çœ‹ç»™å®šç±»åž‹çš„æ–‡æ¡£æ¥ç¡®è®¤
    - æ‰€æœ‰æ•´æ•°ç±»åž‹
    - å¸ƒå°”ç±»åž‹
    - æµ®ç‚¹æ•°ç±»åž‹
    - å­—ç¬¦ç±»åž‹ char
    - å…ƒç»„ï¼Œä¸”å…¶åŒ…å«çš„ä¹Ÿæ˜¯å¯ä»¥ copy çš„ç±»åž‹æ—¶
    - ä¸å¯å˜å¼•ç”¨ &T

## å‡½æ•°ä¼ å€¼ä¸Žè¿”å›ž

- å°†å€¼ä¼ é€’ç»™å‡½æ•°ï¼Œä¸€æ ·ä¼šå‘ç”Ÿ`ç§»åŠ¨`æˆ–è€…`å¤åˆ¶`

- ```rust
    fn main() {
        let s = String::from("hello");  // s è¿›å…¥ä½œç”¨åŸŸ

        takes_ownership(s);             // s çš„å€¼ç§»åŠ¨åˆ°å‡½æ•°é‡Œ ...
                                        // ... æ‰€ä»¥åˆ°è¿™é‡Œä¸å†æœ‰æ•ˆ

        let x = 5;                      // x è¿›å…¥ä½œç”¨åŸŸ

        makes_copy(x);                  // x åº”è¯¥ç§»åŠ¨å‡½æ•°é‡Œï¼Œ
                                        // ä½† i32 æ˜¯ Copy çš„ï¼Œæ‰€ä»¥åœ¨åŽé¢å¯ç»§ç»­ä½¿ç”¨ x

    } // è¿™é‡Œ, x å…ˆç§»å‡ºäº†ä½œç”¨åŸŸï¼Œç„¶åŽæ˜¯ sã€‚ä½†å› ä¸º s çš„å€¼å·²è¢«ç§»èµ°ï¼Œ
      // æ‰€ä»¥ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ

    fn takes_ownership(some_string: String) { // some_string è¿›å…¥ä½œç”¨åŸŸ
        println!("{}", some_string);
    } // è¿™é‡Œï¼Œsome_string ç§»å‡ºä½œç”¨åŸŸå¹¶è°ƒç”¨ `drop` æ–¹æ³•ã€‚å ç”¨çš„å†…å­˜è¢«é‡Šæ”¾

    fn makes_copy(some_integer: i32) { // some_integer è¿›å…¥ä½œç”¨åŸŸ
        println!("{}", some_integer);
    } // è¿™é‡Œï¼Œsome_integer ç§»å‡ºä½œç”¨åŸŸã€‚ä¸ä¼šæœ‰ç‰¹æ®Šæ“ä½œ
  ```

- ç›¸æ¯” js çš„çµæ´»ï¼Œåœ¨ rust ä¸­ï¼Œå°±ä¸èƒ½ä»»æ„äº†

- Rust éº»çƒ¦ï¼š**æ€»æ˜¯æŠŠä¸€ä¸ªå€¼ä¼ æ¥ä¼ åŽ»æ¥ä½¿ç”¨å®ƒ**ã€‚ ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¾ˆå¯èƒ½è¿˜è¦ä»Žè¯¥å‡½æ•°ä¼ å‡ºåŽ»ï¼Œç»“æžœå°±æ˜¯è¯­è¨€è¡¨è¾¾å˜å¾—éžå¸¸å•°å—¦ï¼Œå¹¸è¿çš„æ˜¯ï¼ŒRust æä¾›äº†æ–°åŠŸèƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

## å¼•ç”¨ä¸Žå€Ÿç”¨

- ä¹°æˆ¿å’Œç§Ÿæˆ¿ï¼Ÿï¼ˆä¸æ˜¯ç‰¹åˆ«åˆé€‚

  ```rust
  fn main() {
      let x = 5; // å€¼ 5 çš„æ‰€æœ‰è€…æ˜¯ å˜é‡ x
      let y = &x; // æ‰€æœ‰è€… x å°†å€¼ 5 å‡ºç§Ÿç»™ yï¼Œ&x è¡¨ç¤ºç­¾äº†å‡ºç§ŸåˆåŒðŸ˜‚

      assert_eq!(5, x); // 5 æ˜¯ x çš„ï¼Œæ²¡é—®é¢˜
      assert_eq!(5, *y); // 5 é‡Œé¢ä½çš„æ˜¯ yï¼Œæ˜¯ç§Ÿç”¨ï¼Œæ‰€ä»¥æ˜¯ *yï¼Œ* è¡¨æ˜Žè§£å¼•ç”¨ï¼Œæ‰¾åˆ° y çš„æˆ¿ä¸œ
      // ä½†è¦æ˜¯ assert_eq!(5, y)ï¼Œå°±ä¸å¯¹äº†ï¼Œåªæ˜¯å‡ºç§Ÿï¼Œä¸æ˜¯å–ç»™ yã€‚
  }
  ```

- å¯¹æ¯”ï¼Œä¸å…è®¸æ¯”è¾ƒä¸åŒçš„ç±»åž‹ï¼Œå¿…é¡»ä½¿ç”¨è§£å¼•ç”¨è¿ç®—ç¬¦ï¼Œè§£å‡ºå¼•ç”¨æ‰€æŒ‡å‘çš„å€¼

## ä¸å¯å˜å¼•ç”¨ &T

- å°†å˜é‡çš„å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’

- ```rust
    fn main() {
        let s1 = String::from("hello");

        // ä¼ é€’ç»™å‡½æ•°çš„æ˜¯ s1 çš„å¼•ç”¨
        let len = calculate_length(&s1);

        println!("The length of '{}' is {}.", s1, len);
    }

    fn calculate_length(s: &String) -> usize {
        s.len()
    }
  ```

- æ— éœ€åƒå‰é¢çš„ä»£ç ä¸€æ ·ï¼šå…ˆé€šè¿‡å‡½æ•°å‚æ•°ä¼ å…¥å˜é‡ï¼ˆæ‰€æœ‰æƒï¼‰ï¼Œç„¶åŽå†é€šè¿‡å‡½æ•°è¿”å›žæ¥ä¼ å‡ºæ‰€æœ‰æƒï¼Œä»£ç æ›´åŠ ç®€æ´

- å‡½æ•°`calculate_length`çš„å‚æ•°ç±»åž‹ä»Ž String å˜ä¸º &String

- & ç¬¦å·å³æ˜¯å¼•ç”¨ï¼Œå®ƒå…è®¸æˆ‘ä»¬ä½¿ç”¨å˜é‡çš„å€¼ï¼Œä½†æ˜¯ä¸èŽ·å–æ‰€æœ‰æƒã€‚

## å¯å˜å¼•ç”¨ &mut T

```rust
fn main() {
    let mut s = String::from("hello");

    change(&mut s);
}

fn change(some_string: &mut String) {
    some_string.push_str(", world");
}
```

- ä¿®æ”¹ä¼ å€¼å’Œå‚æ•°ç±»åž‹å°±å¯ä»¥åœ¨å‡½æ•°ä¸­ä¹Ÿèƒ½ä¿®æ”¹å˜é‡äº†

### å¯å˜å¼•ç”¨åŒæ—¶åªèƒ½å­˜åœ¨ä¸€ä¸ª

- è¿™æ ·é™åˆ¶çš„å¥½å¤„å°±æ˜¯ä½¿ Rust åœ¨ç¼–è¯‘æœŸå°±é¿å…æ•°æ®ç«žäº‰ï¼Œæ•°æ®ç«žäº‰å¯ç”±ä»¥ä¸‹è¡Œä¸ºé€ æˆï¼š
  - ä¸¤ä¸ªæˆ–æ›´å¤šçš„æŒ‡é’ˆåŒæ—¶è®¿é—®åŒä¸€æ•°æ®
  - è‡³å°‘æœ‰ä¸€ä¸ªæŒ‡é’ˆè¢«ç”¨æ¥å†™å…¥æ•°æ®
  - æ²¡æœ‰åŒæ­¥æ•°æ®è®¿é—®çš„æœºåˆ¶
- æ•°æ®ç«žäº‰å¤§ç™½è¯ï¼Œä¿ºçš„ç†è§£å°±æ˜¯ï¼ŒåŒä¸€ä»½æ•°æ®å¤šä¸ªå˜é‡è®¿é—®ï¼Œæœ‰çš„å†™å…¥æœ‰çš„è¯»å–ï¼Œå¯¼è‡´æ•°æ®å‡ºçŽ°é—®é¢˜å•¦

- é€šè¿‡å¤§æ‹¬å·æ¥æ‰‹åŠ¨é™åˆ¶å˜é‡çš„ä½œç”¨åŸŸ

### å¯å˜å¼•ç”¨å’Œä¸å¯å˜å¼•ç”¨ä¸èƒ½åŒæ—¶å­˜åœ¨

Rust çš„ç¼–è¯‘å™¨ä¸€ç›´åœ¨ä¼˜åŒ–ï¼Œæ—©æœŸçš„æ—¶å€™ï¼Œå¼•ç”¨çš„ä½œç”¨åŸŸè·Ÿå˜é‡ä½œç”¨åŸŸæ˜¯ä¸€è‡´çš„ï¼Œè¿™å¯¹æ—¥å¸¸ä½¿ç”¨å¸¦æ¥äº†å¾ˆå¤§çš„å›°æ‰°ï¼Œä½ å¿…é¡»éžå¸¸å°å¿ƒçš„åŽ»å®‰æŽ’å¯å˜ã€ä¸å¯å˜å˜é‡çš„å€Ÿç”¨ï¼Œå…å¾—æ— æ³•é€šè¿‡ç¼–è¯‘ï¼Œä¾‹å¦‚ä»¥ä¸‹ä»£ç ï¼š

```rust
fn main() {
   let mut s = String::from("hello");

    let r1 = &s;
    let r2 = &s;
    println!("{} and {}", r1, r2);
    // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr1,r2ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ

    let r3 = &mut s;
    println!("{}", r3);
} // è€ç¼–è¯‘å™¨ä¸­ï¼Œr1ã€r2ã€r3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
  // æ–°ç¼–è¯‘å™¨ä¸­ï¼Œr3ä½œç”¨åŸŸåœ¨è¿™é‡Œç»“æŸ
```

- æ–°çš„ç¼–è¯‘å™¨ï¼ˆRust 1.31 å¼€å§‹ï¼‰**å¼•ç”¨ä½œç”¨åŸŸçš„ç»“æŸä½ç½®ä»ŽèŠ±æ‹¬å·å˜æˆæœ€åŽä¸€æ¬¡ä½¿ç”¨çš„ä½ç½®**
- NLLï¼ˆNon-Lexical Lifetimesï¼‰ä¸“é—¨ç”¨äºŽæ‰¾åˆ°æŸä¸ªå¼•ç”¨åœ¨ä½œç”¨åŸŸ(})ç»“æŸå‰å°±ä¸å†è¢«ä½¿ç”¨çš„ä½ç½®

## åž‚æ‚¬å¼•ç”¨(Dangling References)

- æ˜¯è¿”å›žäº†ä¸€ä¸ªå€Ÿç”¨çš„å€¼ï¼Œä½†è¿™ä¸ªå€¼å·²ç»è¢« drop äº†

  ```rust
  fn dangle() -> &String { // dangle è¿”å›žä¸€ä¸ªå­—ç¬¦ä¸²çš„å¼•ç”¨

      let s = String::from("hello"); // s æ˜¯ä¸€ä¸ªæ–°å­—ç¬¦ä¸²

      &s // è¿”å›žå­—ç¬¦ä¸² s çš„å¼•ç”¨
  } // è¿™é‡Œ s ç¦»å¼€ä½œç”¨åŸŸå¹¶è¢«ä¸¢å¼ƒã€‚å…¶å†…å­˜è¢«é‡Šæ”¾ã€‚
    // å±é™©ï¼

  ```

- è§£å†³æ–¹æ¡ˆï¼šç›´æŽ¥è¿”å›ž String å°±å¯ä»¥äº†ï¼Œè¿™æ ·å°±æ˜¯æ‰€æœ‰æƒè½¬ç§»ç»™å¤–é¢çš„è°ƒç”¨è€…äº†ã€‚

- ```rust
    fn no_dangle() -> String {
        let s = String::from("hello");

        s
    }

  ```
