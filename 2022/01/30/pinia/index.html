<!DOCTYPE html><html lang="zh-cmn-Hans" prefix="og: http://ogp.me/ns#" class="han-init"><head><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" /><title>Pinia，下一代状态管理库？Vuex的替代品？ &mdash; 鹏程</title><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/vendor/primer-css/css/primer.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/css/components/collection.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/css/components/repo-card.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/css/sections/repo-list.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/css/components/boxed-group.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/css/globals/common.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/css/globals/responsive.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/css/posts/index.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/vendor/octicons/octicons/octicons.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/mzlogin/rouge-themes@master/dist/gruvbox.css" /><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/vendor/share.js/dist/css/share.min.css" /><link rel="canonical" href="https://bran-nie.com/2022/01/30/pinia/" /><link rel="alternate" type="application/atom+xml" title="鹏程" href="https://bran-nie.com/feed.xml" /><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/favicon.ico" /><meta property="og:title" content="Pinia，下一代状态管理库？Vuex的替代品？" /><meta name="keywords" content="Pinia，下一代状态管理库？Vuex的替代品？" /><meta name="og:keywords" content="Pinia，下一代状态管理库？Vuex的替代品？" /><meta name="description" content="在十天前，尤大发布的一篇文章：“Vue 3 将在 2022 年 2 月 7 日成为新的默认版本”中提到，Pinia提供更简洁的状态管理。咦，Vuex 呢？Pinia 又是一个什么样的库？那让我们一探究竟吧～" /><meta name="og:description" content="在十天前，尤大发布的一篇文章：“Vue 3 将在 2022 年 2 月 7 日成为新的默认版本”中提到，Pinia提供更简洁的状态管理。咦，Vuex 呢？Pinia 又是一个什么样的库？那让我们一探究竟吧～" /><meta property="og:url" content="https://bran-nie.com/2022/01/30/pinia/" /><meta property="og:site_name" content="鹏程" /><meta property="og:type" content="article" /><meta property="og:locale" content="zh_CN" /><meta property="article:published_time" content="2022-01-30" /> <script src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/vendor/jquery/dist/jquery.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/js/jquery-ui.js"></script> <script src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/js/main.js?v=2" defer></script></head><body class="" data-mz=""><header class="site-header"><div class="container"><h1> <a href="https://bran-nie.com/" title="鹏程" ><span class="octicon octicon-mark-github"></span> 鹏程</a ></h1><button class="collapsed mobile-visible" type="button" onclick="toggleMenu();"> <span class="icon-bar"></span> <span class="icon-bar"></span> <span class="icon-bar"></span> </button><nav class="site-header-nav" role="navigation"> <a href="https://bran-nie.com/" class=" site-header-nav-item" target="" title="首页" >首页</a > <a href="https://bran-nie.com/categories/" class=" site-header-nav-item" target="" title="分类" >分类</a > <a href="https://bran-nie.com/wiki/" class=" site-header-nav-item" target="" title="维基" >维基</a > <a href="https://bran-nie.com/links/" class=" site-header-nav-item" target="" title="链接" >链接</a > <a href="https://bran-nie.com/about/" class=" site-header-nav-item" target="" title="关于" >关于</a ></nav></div></header><style> html.dark-mode, html.dark-mode img { filter: invert(1) hue-rotate(180deg); } html.dark-mode img { opacity: 0.85; } body { position: relative; } #darkContainer { position: fixed; z-index: 100; bottom: 50px; left: 100px; display: inline-flex; } @media (max-width: 50em) { #darkContainer { position: absolute; transform: scale(0.8); bottom: 5px; left: 8px; } } #darkContainer .text { margin-right: 8px; } #darkContainer .switch-btn { user-select: none; display: inline-block; width: 50px; border: none; height: 25px; border-radius: 50px; background: rgba(0, 0, 0, 0.25); cursor: pointer; transition: all 0.2s; position: relative; outline: none; } #darkContainer .switch-btn.switch-btn-checked { background: #1890ff; } #darkContainer .switch-btn .switch-handle { height: 20px; width: 20px; background: #fff; border-radius: 50%; position: absolute; top: 2px; left: 4px; transition: all 0.2s ease-in-out; } #darkContainer .switch-btn.switch-btn-checked .switch-handle { left: calc(100% - 22px); }</style><script> let isDarkMode = localStorage.getItem('isDarkMode'); if (isDarkMode === 'true') { document.firstElementChild.classList.add('dark-mode'); } </script> <script defer> const darkContainer = document.createElement('div'); darkContainer.id = 'darkContainer'; darkContainer.innerHTML = `<span class="text">深色模式</span>`; const btnEl = document.createElement('button'); btnEl.classList.add('switch-btn'); btnEl.innerHTML = `<div class="switch-handle"></div>`; if (isDarkMode === 'true') { btnEl.classList.add('switch-btn-checked'); } btnEl.addEventListener('click', (e) => { if (btnEl.classList.contains('switch-btn-checked')) { btnEl.classList.remove('switch-btn-checked'); document.firstElementChild.classList.remove('dark-mode'); localStorage.setItem('isDarkMode', 'false'); } else { btnEl.classList.add('switch-btn-checked'); document.firstElementChild.classList.add('dark-mode'); localStorage.setItem('isDarkMode', 'true'); } }); darkContainer.append(btnEl); document.body.appendChild(darkContainer); </script></body></html><section class="collection-head small geopattern" data-pattern-id="Pinia，下一代状态管理库？" ><div class="container"><div class="columns"><div class="column three-fourths"><div class="collection-title"><h1 class="collection-header">Pinia，下一代状态管理库？Vuex的替代品？</h1><div class="collection-info"> <span class="meta-info"> <span class="octicon octicon-calendar"></span> 2022/01/30 </span> <span class="meta-info"> <span class="octicon octicon-file-directory"></span> <a href="https://bran-nie.com/categories/#Blog" title="Blog" >Blog</a > </span> <span class="meta-info"> <span class="octicon octicon-clock"></span> 共 2724 字，约 8 分钟 </span></div></div></div><div class="column one-fourth mobile-hidden"><div class="collection-title"></div></div></div></div></section><section class="container content"><div class="columns"><div class="column three-fourths"><article class="article-content markdown-body"><p>在十天前，尤大发布的一篇文章：<strong><a href="https://gist.github.com/yyx990803/bf9a625eeff8b471bf0701afb8e3fe75" target="\_blank">“Vue 3 将在 2022 年 2 月 7 日成为新的默认版本”</a></strong>中提到，<code class="language-plaintext highlighter-rouge">Pinia</code>提供更简洁的状态管理。咦，Vuex 呢？Pinia 又是一个什么样的库？那让我们一探究竟吧～</p><p>惯例，先看一下 Pinia 的介绍。</p><h2 id="pinia-简介">Pinia 简介</h2><p>在 2019 年 11 月左右，Pinia 最初是为 Composition API 风格的 Vue 的状态管理而生。发展至今，Pinia 是一个颇为成熟的 Vue 的状态管理库，它允许用户跨组件/页面共享状态，且在使用方式上，更加贴近 Vue3 的组合式 API 方式：</p><p>声明：<code class="language-plaintext highlighter-rouge">export const useStore = defineStore('main',{xxx})</code></p><p>使用：<code class="language-plaintext highlighter-rouge">const store = useStore()</code></p><p>截止到本文编写之时，Pinia(v2.0.11) 可以提供的功能：</p><ul><li>开发工具的支持<ul><li>跟踪 state 改变、 action 的 Timeline，</li><li>在组件中查看 store</li><li>更加容易的调试 Timeline</li></ul></li><li>热更新<ul><li>在不重载页面时，变更 store，</li><li>在开发时保持任何现有的状态</li></ul></li><li>插件功能，可以更自由的扩展 Pinia 功能，</li><li>对 TypeScript 更加友好的支持</li><li>服务器端渲染支持</li></ul><h2 id="pinia-vs-vuex">Pinia VS Vuex</h2><p>vite 搭一个 vue3+ts 的 demo，简单的上手 Pinia 后，感觉 Pinia 作为新的 Vue 全家桶成员，那种流畅感很强。那么相比 Vuex，它有什么区别呢？</p><p>Pinia 的作者(Eduardo)也是 Vue 核心成员之一，且也是参与 Vuex 的设计开发的，对于 Pinia，作者最初是探索下一代的 Vuex 是什么样的，结合 Vuex 5 核心团队讨论中的想法，发现 Pinia 已经实现了他们在 Vuex 5 中想要的大部分内容，因此决定实现 Pinia。</p><p>与 Vuex 相比，Pinia 提供了更简单的 API，也更加简洁，提供了组合式风格的 API，最重要的是，它对 TypeScript 的支持，是 Vuex &lt;= 4 无法比拟的。在未来，Pinia 不断发展中，可能还会融入 Vuex 中，但那已经是 Vuex 5 及之后了。</p><p>来自官方的对比：Pinia API 与 Vuex &lt;=4 的不同：</p><ul><li>没有 mutations。mutations 被认为是非常冗长的。</li><li>无需创建自定义复杂包装器来支持 TypeScript，所有内容都是类型化的，并且 API 的设计方式尽可能利用 TS 类型推断。</li><li>不再需要注入魔法字符串、导入函数、调用它们，享受自动完成功能！</li><li>无需动态添加 store，默认情况下它们都是动态的，您甚至不会注意到。请注意，您仍然可以随时手动使用 store 来注册它，但因为它是自动的，所以您无需担心。</li><li>不再有模块的嵌套结构。您仍然可以通过在另一个 store 中导入和使用 store 来隐式嵌套 store，但 Pinia 通过设计提供扁平结构，同时仍然支持 store 之间的交叉组合方式。您甚至可以拥有 store 的循环依赖关系。</li><li>没有命名空间模块。鉴于 store 的扁平架构，命名空间 store 是其定义方式所固有的，您可以说所有 store 都是命名空间的。</li></ul><h2 id="pinia-初探">Pinia 初探</h2><h3 id="安装">安装</h3><p><code class="language-plaintext highlighter-rouge">pnpm/yarn add pinia </code> or <code class="language-plaintext highlighter-rouge">npm install pinia</code>.</p><h3 id="使用">使用</h3><h4 id="1-在应用程序中注入-pinia-插件">1. 在应用程序中注入 pinia 插件</h4><div class="language-typescript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createApp</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">vue</span><span class="dl">'</span><span class="p">;</span>
<span class="k">import</span> <span class="p">{</span> <span class="nx">createPinia</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">pinia</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">createApp</span><span class="p">(</span><span class="nx">xxx</span><span class="p">).</span><span class="nx">use</span><span class="p">(</span><span class="nx">createPinia</span><span class="p">());</span>
</code></pre></div></div><p>对于搭配 Vue2 使用时，还需要安装 <code class="language-plaintext highlighter-rouge">@vue/composition-api</code> ,</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">createPinia</span><span class="p">,</span> <span class="nx">PiniaVuePlugin</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">pinia</span><span class="dl">'</span><span class="p">;</span>

<span class="nx">Vue</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">PiniaVuePlugin</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">pinia</span> <span class="o">=</span> <span class="nx">createPinia</span><span class="p">();</span>

<span class="k">new</span> <span class="nx">Vue</span><span class="p">({</span>
    <span class="na">el</span><span class="p">:</span> <span class="dl">'</span><span class="s1">#app</span><span class="dl">'</span><span class="p">,</span>
    <span class="c1">// other options...</span>
    <span class="c1">// ...</span>
    <span class="c1">// note the same `pinia` instance can be used across multiple Vue apps on</span>
    <span class="c1">// the same page</span>
    <span class="nx">pinia</span><span class="p">,</span>
<span class="p">});</span>
</code></pre></div></div><h4 id="2-定义-store">2. 定义 store</h4><p>如同一个变量、函数，在使用之前，需要先声明定义，在 Pinia 中 store 也是如此，通过<code class="language-plaintext highlighter-rouge">defineStore</code>定义一个 store，其中，’xxx’ 是 store 的唯一 ID，在 devtools 中也可以查看。另外，通常将返回的函数命名为 use… 是组合式风格的一个约定，而 useXxxStore 中的 Xxx 通常是该 store 所属的功能或者类。</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">defineStore</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">pinia</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="kd">const</span> <span class="nx">useXxxStore</span> <span class="o">=</span> <span class="nx">defineStore</span><span class="p">(</span><span class="dl">'</span><span class="s1">xxx</span><span class="dl">'</span><span class="p">,</span> <span class="p">{});</span>
</code></pre></div></div><h4 id="3-使用-store">3. 使用 store</h4><p>实例化 store 后，就可以通过实例访问定义在 state、getter 中的属性，也可以调用 action 中的方法。</p><div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="p">{</span> <span class="nx">useXxxStore</span> <span class="p">}</span> <span class="k">from</span> <span class="dl">'</span><span class="s1">@/stores/xxx</span><span class="dl">'</span><span class="p">;</span>

<span class="k">export</span> <span class="k">default</span> <span class="p">{</span>
    <span class="nx">setup</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">xxx</span> <span class="o">=</span> <span class="nx">useXxxStore</span><span class="p">();</span>
        <span class="c1">// use store</span>
        <span class="c1">// xxx.xxx</span>
    <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div><h4 id="关注点">关注点</h4><ol><li>store 是一个用 reactive 包裹的对象，也就意味着，它不能解构，否则会失去其响应性，如<code class="language-plaintext highlighter-rouge">cosnt { count } = counterStore</code>，不过，可以使用 <code class="language-plaintext highlighter-rouge">storeToRefs()</code>进行解构。</li><li>由于这是一个组合式风格的状态代码，我们可以为不同的功能模块，用不同的文件定义 store，只需要在相应的功能模块引入即可。这对代码拆分和逻辑拆分都很有用。</li></ol><h4 id="getters">Getters</h4><p>Pinia 的 getters 与 Vuex 的 getter 区别不大，不过在访问时，Vuex 是<code class="language-plaintext highlighter-rouge">store.getters.xxx</code>，Pinia 不需要再多一层，则是<code class="language-plaintext highlighter-rouge">store.xxx</code>，如同 state。</p><h4 id="actions">Actions</h4><p>action 相当于组件中的方法(methods)，通过 actions 属性声明定义，与 Vuex 一样，action 也可以是异步的，对了，与 Vuex 不同的是，Pinia 取消了 mutation。个人感觉可能认为 mutation 和 action 有一定的重复吧。</p><h2 id="展望-pinia">展望 Pinia</h2><ul><li>直观，像组件一样书写 store</li><li>TypeScript 带来的类型安全</li><li>Vue devtools 提供不错的开发体验</li><li>模块化设计，构建多个 store 文件，对逻辑、代码拆分极有帮助</li><li>插件功能，扩展性很好</li><li>文件大小极小，约 1kb</li></ul><h2 id="最后--总结">最后 &amp; 总结</h2><p>Pinia 相比 Vuex 更加简单、简洁，还可以自由扩展</p><p>Pinia 更加符合直觉的状态管理方式，模块化的导入导出使得状态的来龙去脉更加清晰</p><p>再者，Pinia 可以理解是下一代的 Vuex，后面可能会融入到 Vuex 5 中呢，目前 Vue 3 已经将 Pinia 作为官方推荐状态管理库了，即便是在生产环境中，也是可以使用了。</p><div style="margin-top:2em;padding:0 1.5em;border:1px solid #d3d3d3;background-color:#deebf7"><h3>文档信息</h3><ul><li>本文作者：<a href="https://bran-nie.com" target="_blank">Bran.nie</a></li><li>本文链接：<a href="https://bran-nie.com/2022/01/30/pinia/" target="_blank">https://bran-nie.com/2022/01/30/pinia/</a></li><li>版权声明：自由转载-非商用-非衍生-保持署名（<a href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh" target="_blank">创意共享3.0许可证</a>）</li></ul></div></article><div class="share"><div class="share-component"></div></div><div class="comment"><div id="gitalk-container"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/vendor/gitalk/gitalk.css"> <script src="https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js"></script> <script> var gitalk = new Gitalk({ id: '/2022/01/30/pinia/', clientID: '2de5c26774734ef5886c', clientSecret: '29d08007f41b856632995a2fa39aca6cc682a09f', repo: 'bran-nie.github.io', owner: 'bran-nie', admin: ['bran-nie'], labels: ['gitment'], perPage: 50, }); gitalk.render('gitalk-container'); </script></div></div><div class="column one-fourth"><h3>Search</h3><div id="site_search"> <input style="width: 96%" type="text" id="search_box" placeholder="Search" /></div><ul id="search_results" style="font-size: 14px; list-style-type: none; padding-top: 10px; padding-left: 10px"></ul><script src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/js/simple-jekyll-search.min.js"></script> <script type="text/javascript"> var searchLimit = Number('10'); searchLimit = typeof searchLimit === 'number' ? searchLimit : 8; SimpleJekyllSearch({ searchInput: document.getElementById('search_box'), resultsContainer: document.getElementById('search_results'), json: 'https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@built/assets/search_data.json?v=1644904108', searchResultTemplate: '<li><a href="{url}" title="{title}">{title}</a></li>', noResultsText: 'No results found', limit: searchLimit, fuzzy: false, exclude: ['Welcome'], }); </script><h3 class="post-directory-title mobile-hidden">Table of Contents</h3><div id="post-directory-module" class="mobile-hidden"><section class="post-directory"><dl></dl></section></div><script src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/js/jquery.toc.js"></script></div></div></section><footer class="container"><div class="site-footer" role="contentinfo"><div class="copyright left mobile-block"> © 2016 <span title="Bran.nie">Bran.nie</span> <a href="javascript:window.scrollTo({behavior: 'smooth', top: 0})" class="right mobile-visible">TOP</a></div><ul class="site-footer-links right mobile-hidden"><li> <a href="javascript:window.scrollTo({behavior: 'smooth', top: 0})" >TOP</a></li></ul><a href="https://github.com/bran-nie/bran-nie.github.io" target="_blank" aria-label="view source code"> <span class="mega-octicon octicon-mark-github" title="GitHub"></span> </a><ul class="site-footer-links mobile-hidden"><li> <a href="https://bran-nie.com/" title="首页" target="">首页</a></li><li> <a href="https://bran-nie.com/categories/" title="分类" target="">分类</a></li><li> <a href="https://bran-nie.com/wiki/" title="维基" target="">维基</a></li><li> <a href="https://bran-nie.com/links/" title="链接" target="">链接</a></li><li> <a href="https://bran-nie.com/about/" title="关于" target="">关于</a></li><li><a href="https://bran-nie.com/feed.xml"><span class="octicon octicon-rss" style="color:orange;"></span></a></li></ul><script async src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/vendor/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="mobile-hidden" style="margin-top:8px"> <span id="busuanzi_container_site_pv" style="display:none"> 本站访问量<span id="busuanzi_value_site_pv"></span>次 </span> <span id="busuanzi_container_site_uv" style="display:none"> / 本站访客数<span id="busuanzi_value_site_uv"></span>人 </span> <span id="busuanzi_container_page_pv" style="display:none"> / 本页访问量<span id="busuanzi_value_page_pv"></span>次 / 统计始于2021-03-01 </span></div></div></footer><div class="tools-wrapper"> <a class="gotop" href="#" title="回到顶部"><span class="octicon octicon-arrow-up"></span></a></div><script src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/vendor/share.js/dist/js/share.min.js"></script> <script src="https://cdn.jsdelivr.net/gh/bran-nie/bran-nie.github.io@master/assets/js/geopattern.js"></script> <script> jQuery(document).ready(function($) { $('.geopattern').each(function(){ $(this).geopattern($(this).data('pattern-id')); }); /* hljs.initHighlightingOnLoad(); */ }); </script></body></html>
